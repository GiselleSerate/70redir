<!DOCTYPE html>
<html>
<head>
    <title>CS 70 Grutoring Queue Redirect</title>
    <script>
        // The queue will be active for these hours.
        // Note if 1 is listed as an active hour, the queue will close at 2. 
        // If status is 1, office hours; if status is 2, grutoring hours. 
        var schedule = {
            // [PROFS] Friday, 2-3
            // Friday, nothing
            5: {
                     11: 2,
                     12: 2,
                     13: 2,
                     14: 2,
//                   16: 2,
//                   17: 2,
//                   18: 2,
//                   19: 2,
            },
            // Saturday, 10 AM - 12 AM
            6: {
                10: 2,
                11: 2,
                12: 2,
                13: 2,
                14: 2,
                15: 2,
                16: 2,
                17: 2,
                18: 2,
                19: 2,
                20: 2,
                21: 2,
                22: 2,
                23: 2,
            },
            // Sunday, 10AM - 12AM
            0: {
                10: 2,
                11: 2,
                12: 2,
                13: 2,
                14: 2,
                15: 2,
                16: 2,
                17: 2,
                18: 2,
                19: 2,
                20: 2,
                21: 2,
                22: 2,
                23: 2,
            },
            // Monday, 11 - 1, 4 - 10
            1: {
                11: 2,
                12: 2,
                16: 2,
                17: 2,
                18: 2,
                19: 2,
                20: 2,
                21: 2,
            },
            // Tuesday, 11 - 1, 4 - 10
            2: {
                11: 2,
                12: 2,
                16: 2,
                17: 2,
                18: 2,
                19: 2,
                20: 2,
                21: 2,
            },
            // Wednesday, 11 - 1, 4 - 10
            3: {
                11: 2,
                12: 2,
                16: 2,
                17: 2,
                18: 2,
                19: 2,
                20: 2,
                21: 2,
            },
            // Thursday, 4-8
            4: {
                16: 2,
                17: 2,
                18: 2,
                19: 2,
            }
        }

        var numToDay = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

        // Redirects if we are within scheduled grutoring hours.
        function checkSchedule() {
            var date = changeTimezone(new Date(), "Europe/London");
            var day = date.getDay();
            var hour = date.getHours();
            console.log(day)
            console.log(hour)

            console.log("Schedule checked. Today is " + day + " and the hour is " + hour + ".");
            if (day in schedule && hour in schedule[day]) {
                console.log("Redirecting.")
                // window.location.assign("https://docs.google.com/forms/d/e/1FAIpQLSd4uV3FICjYIDCnAeQYtDOWrL1dQOyuwmD76CXuO_gSjnv6wQ/viewform");
            }
            populateSchedule(); // TODO: well heck, guess we'll do this. 
        }
        
        
        // Source: https://stackoverflow.com/questions/15141762/how-to-initialize-a-javascript-date-to-a-particular-time-zone
        // Comments apply to case when ianatz = 'America/Toronto'
        // Handles time zones for remote school
        function changeTimezone(date, ianatz) {
            // suppose the date is 12:00 UTC
            var invdate = new Date(date.toLocaleString('en-US', {
                timeZone: ianatz
            }));

            // then invdate will be 07:00 in Toronto
            // and the diff is 5 hours
            var diff = date.getTime() - invdate.getTime();

            // so 12:00 in Toronto is 17:00 UTC
            return new Date(date.getTime() - diff); // needs to substract
        }
        

        // Convert military time to AM/PM string.
        function convertTime(time) {
            ampm = "AM";
            if(time > 12) {
                time = time - 12;
                ampm = "PM";
            }
            return time+":00 "+ampm;
        }

        // Populate schedule div.
        function populateSchedule() {
            console.log("Populating schedule.");
            console.log(schedule);
            var scheduleDiv = document.getElementById("schedule");
            for (day in schedule) {
                var newDay = "<div>"
                // Add header.
                newDay += "<div class=sched-header>"+numToDay[day]+"</div>";
                for (time in schedule[day]) {
                    if (schedule[day][time] == 1) {
                        attr = "prof"
                    }
                    else {
                        attr = "grutor"
                    }
                    newDay += "<div class='" + attr + "'>"+convertTime(time)+"</div>";
                }
                newDay += "</div>";
                scheduleDiv.innerHTML += newDay;
            }
        }

        window.onload = checkSchedule;
    </script>
    <style>
        #schedule {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        .sched-header {
            font-weight: bold;
        }
        .grutor {
            background: yellow;
        }
        .prof {
            background: orange;
        }
    </style>
</head>
<body>
    <h1>
        Looking for the CS 70 digital queue?
    </h1>
<!--     <p>
        Since there is not an assigment this week, grutoring will resume on Thursday, October 1. In the meantime, 
        if you have quuestions about the proficiency checks, post on Piazza and if need be we can set up a time for one-on-one grutoring!
    </p> -->
    <p>
        The queue will be back soon! 
    </p>
    <p>
        Here's the office hours schedule for profs (orange) and grutors (yellow):
    </p>
    <div id="schedule"></div>
    <p>
        (If you're seeing this page and it's actually during grutoring hours, please email <a href="mailto:sthomas@g.hmc.edu">sthomas@g.hmc.edu</a> so it can be fixed in a timely manner.)
    </p>
</body>
</html>
